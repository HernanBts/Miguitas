@model IEnumerable<Miguitas.Web.Data.Entities.Order>

@{
    ViewData["Title"] = "CustomerOrders";
}

    <div class="bg-img-board container" style="padding-bottom:1%">
        <h2 class="text-center">Enviar Pedido</h2>
        <div>
            <h2>
                @foreach (var item in Model)
                {
                    @Html.DisplayFor(modelItem => item.User.FullName)
                }
            </h2>
        </div>

        <table class="table text-light">
            <thead>
                <tr>
                    <th>
                        @Html.DisplayNameFor(model => model.OrderDate)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.DeliveryDate)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.Lines)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.Quantity)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.Value)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.OrderDateLocal)
                    </th>

                    <th></th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr>
                        <td>
                            @Html.DisplayFor(modelItem => item.OrderDate)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.DeliveryDate)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.Lines)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.Quantity)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.Value)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.OrderDateLocal)
                        </td>
                        <td>
                            <a asp-action="Deliver" asp-route-id="@item.Id" class="btn btn-warning" id="btnDeliver">Enviar</a>
                            <a asp-action="OrderDetails" asp-route-id="@item.Id" class="btn btn-info">Detalle</a>
                            <button data-id="@item.Id" class="btn btn-danger deleteOrderItem" data-toggle="modal" data-target="#deleteDialog">Borrar</button>
                            @*<button data-id="@item" class="btn btn-warning userItem" data-toggle="modal" data-target="#userDialog">Ver</button>*@
                        </td>
                    </tr>
                }
            </tbody>
        </table>
        </div>
        <!-- delete Order-->
        <div class="modal fade" id="deleteDialog" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-sm" role="document">
                <div class="modal-content bg-dark">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Confirm Order</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <p>¿Desea borrar el pedido?</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                        <button type="button" class="btn btn-success" id="btnYes">Borrar</button>
                    </div>
                </div>
            </div>
        </div>

        @section Scripts {
            @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}

            <script type="text/javascript">
                $(document).ready(function () {

                    // Confirm Order
                    $("#btnYes").click(function () {
                        window.location.href = '/Orders/ConfirmOrder';
                    });

                    // Delete item
                    var item_to_delete;

                    $('.deleteItem').click((e) => {
                        item_to_delete = e.currentTarget.dataset.id;
                    });

                    $("#btnYesDelete").click(function () {
                        window.location.href = '/Orders/DeleteItem/' + item_to_delete;
                    });
                });

            </script>
        }
